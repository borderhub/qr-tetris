(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3792:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var n=r(5155),l=r(2115),a=r(109),s=r(2185),c=r(7082),i=r(4651),o=r(6949),h=r(3585),d=r(4345),u=r(2644),m=r(2173);let x=[{shape:[[1,1,1,1]],color:[0,255,255]},{shape:[[1,1],[1,1]],color:[255,255,0]},{shape:[[0,1,0],[1,1,1]],color:[128,0,128]},{shape:[[0,1,1],[1,1,0]],color:[0,255,0]},{shape:[[1,1,0],[0,1,1]],color:[255,0,0]},{shape:[[1,0,0],[1,1,1]],color:[0,0,255]},{shape:[[0,0,1],[1,1,1]],color:[255,165,0]}];function f(){let e=(0,l.useRef)(null),t=(0,l.useRef)(null),r=(0,l.useRef)(0),[f,p]=(0,l.useState)([]),[j,v]=(0,l.useState)([]),[g,w]=(0,l.useState)(null),[b,y]=(0,l.useState)(!1),[N,k]=(0,l.useState)(!1),[S,A]=(0,l.useState)(!1),[D,C]=(0,l.useState)(0),[E,R]=(0,l.useState)(0),[M,T]=(0,l.useState)(0),[F,L]=(0,l.useState)(0),[z,O]=(0,l.useState)(0),[_,Q]=(0,l.useState)(20),[q,I]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=()=>{I(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let B=(0,l.useCallback)(()=>{if(!F||!z)return 20;let e=window.innerWidth;return Math.max(8,Math.floor(Math.min(.8*e/F,.6*window.innerHeight/z,30)))},[F,z]);(0,l.useEffect)(()=>{let e,t=()=>{Q(B())},r=()=>{clearTimeout(e),e=setTimeout(t,100)};return t(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),clearTimeout(e)}},[B]);let H=(0,l.useCallback)(e=>{let t=document.createElement("canvas"),r=t.getContext("2d");t.width=e.width,t.height=e.height,r.drawImage(e,0,0);let n=r.getImageData(0,0,e.width,e.height).data,l=Math.min(e.width,e.height),a=J(l),s=[],c=[];for(let t=0;t<a;t++){s[t]=[],c[t]=[];for(let r=0;r<a;r++){let i=Math.floor(r*l/a),o=(Math.floor(t*l/a)*e.width+i)*4,h=(n[o]+n[o+1]+n[o+2])/3;s[t][r]=+(h<128),c[t][r]=0}}P(s,c,a),p(s),v(c),L(a),O(a),R(U(s,c)),y(!0)},[]),J=e=>e<=25?21:e<=30?25:e<=35?29:Math.min(41,Math.max(21,2*Math.floor(e/8)+1)),P=(e,t,r)=>{for(let n=0;n<r;n++)for(let l=0;l<r;l++)(l<9&&n<9||l>=r-8&&n<9||l<9&&n>=r-8)&&(t[n][l]=e[n][l])},U=(e,t)=>{let r=0;for(let n=0;n<e.length;n++)for(let l=0;l<e[n].length;l++)1===e[n][l]&&0===t[n][l]&&r++;return r},W=(0,l.useCallback)(()=>{let e=x[Math.floor(Math.random()*x.length)];return{x:Math.floor((F-e.shape[0].length)/2),y:0,shape:JSON.parse(JSON.stringify(e.shape)),color:e.color,width:e.shape[0].length,height:e.shape.length}},[F]),G=e=>{let t=[],r=e.shape.length,n=e.shape[0].length;for(let l=0;l<n;l++){t[l]=[];for(let n=0;n<r;n++)t[l][n]=e.shape[r-1-n][l]}return{...e,shape:t,width:t[0].length,height:t.length}},K=(e,t,r)=>{for(let n=0;n<e.height;n++)for(let l=0;l<e.width;l++)if(1===e.shape[n][l]){let e=t+l,a=r+n;if(e<0||e>=F||a<0||a>=z||j[a]&&0!==j[a][e])return!1}return!0},V=(0,l.useCallback)(()=>{if(!g)return;let e=!1,t=[...j];for(let r=0;r<g.height;r++)for(let n=0;n<g.width;n++)if(1===g.shape[r][n]){let l=g.x+n,a=g.y+r;l>=0&&l<F&&a>=0&&a<z&&1===f[a][l]&&0===j[a][l]&&(t[a][l]=1,C(e=>e+1),e=!0)}e&&v(t),w(W())},[g,j,f,F,z,W]),X=(0,l.useCallback)(()=>{y(!1),A(!1),w(null),p([]),v([]),C(0),R(0),T(0),L(0),O(0),k(!1),r.current&&cancelAnimationFrame(r.current),t.current&&(t.current.value="");let e=document.querySelector(".popup");e&&e.remove()},[]),Y=e=>{if(g&&!S)switch(e){case"left":K(g,g.x-1,g.y)&&w(e=>e?{...e,x:e.x-1}:null);break;case"right":K(g,g.x+1,g.y)&&w(e=>e?{...e,x:e.x+1}:null);break;case"down":K(g,g.x,g.y+1)&&w(e=>e?{...e,y:e.y+1}:null);break;case"rotate":let t=G(g);K(t,t.x,t.y)&&w(t);break;case"place":V();break;case"pause":k(!0);break;case"restart":k(!1)}};(0,l.useEffect)(()=>{let e=e=>{if(g&&!N&&!S)switch(e.code){case"ArrowLeft":K(g,g.x-1,g.y)&&w(e=>e?{...e,x:e.x-1}:null);break;case"ArrowRight":K(g,g.x+1,g.y)&&w(e=>e?{...e,x:e.x+1}:null);break;case"ArrowDown":K(g,g.x,g.y+1)&&w(e=>e?{...e,y:e.y+1}:null);break;case"ArrowUp":let t=G(g);K(t,t.x,t.y)&&w(t);break;case"Enter":V();break;case"Space":e.preventDefault(),k(e=>!e)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[g,N,S,V]),(0,l.useEffect)(()=>{if(!b||S||!g||N){r.current&&cancelAnimationFrame(r.current);return}let e=()=>{T(e=>{if(e>=60)if(K(g,g.x,g.y+1))return w(e=>e?{...e,y:e.y+1}:null),0;else return V(),0;return e+1}),r.current=requestAnimationFrame(e)};return r.current=requestAnimationFrame(e),()=>{r.current&&cancelAnimationFrame(r.current)}},[b,S,g,N,V,60]),(0,l.useEffect)(()=>{if(!b||!e.current)return;let t=e.current,r=t.getContext("2d");t.width=F*_,t.height=z*_,(()=>{r.clearRect(0,0,t.width,t.height),r.fillStyle="#f0f0f0",r.fillRect(0,0,t.width,t.height);for(let e=0;e<z;e++)for(let t=0;t<F;t++){let n=t*_,l=e*_;1===j[e][t]?(r.fillStyle="#000000",r.fillRect(n,l,_,_),r.strokeStyle="#666666"):(1===f[e][t]?r.fillStyle="rgba(200, 200, 255, 0.4)":r.fillStyle="#ffffff",r.fillRect(n,l,_,_),r.strokeStyle="#cccccc"),r.strokeRect(n,l,_,_)}if(g){r.fillStyle="rgba(".concat(g.color[0],", ").concat(g.color[1],", ").concat(g.color[2],", 0.8)"),r.strokeStyle="#000000";for(let e=0;e<g.height;e++)for(let t=0;t<g.width;t++)if(1===g.shape[e][t]){let n=(g.x+t)*_,l=(g.y+e)*_;r.fillRect(n,l,_,_),r.strokeRect(n,l,_,_)}}})()},[b,j,g,f,F,z]),(0,l.useEffect)(()=>{b&&!g&&F>0&&w(W())},[b,g,F,W]),(0,l.useEffect)(()=>{if(S||!b)return;let e=!0;for(let t=0;t<z;t++){for(let r=0;r<F;r++)if(1===f[t][r]&&1!==j[t][r]){e=!1;break}if(!e)break}if(e){A(!0);let e=document.createElement("div");e.className="popup",e.innerHTML="\uD83C\uDF89 COMPLETE! \uD83C\uDF89<br><br>QRコード完成おめでとう！",document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}},[j,f,S,b,z,F]);let Z=e=>{let t=new FileReader;t.onload=e=>{var t;let r=new Image;r.onload=()=>H(r),r.src=null==(t=e.target)?void 0:t.result},t.readAsDataURL(e)},$=E>0?Math.round(D/E*100):0;return(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)("h1",{className:"title",children:"\uD83C\uDFAE QRコードテトリスゲーム"}),(0,n.jsx)("p",{className:"subtitle",children:"QRコードをアップロードして、ブロックを積み重ねて元の画像を完成させよう！"}),!b&&(0,n.jsxs)("div",{className:"upload-area",onDrop:e=>{e.preventDefault();let t=e.dataTransfer.files[0];t&&Z(t)},onDragOver:e=>e.preventDefault(),onClick:()=>{var e;return null==(e=t.current)?void 0:e.click()},children:[(0,n.jsx)("p",{style:{fontSize:"1.3rem",marginBottom:"20px"},children:"\uD83D\uDCF1 QRコードの画像をここにドラッグ＆ドロップ"}),(0,n.jsx)("p",{style:{marginBottom:"20px"},children:"または"}),(0,n.jsx)("button",{className:"upload-btn",children:"\uD83D\uDCC1 ファイルを選択"}),(0,n.jsx)("input",{ref:t,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&Z(r)}})]}),b&&(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"game-area",children:(0,n.jsx)("canvas",{ref:e})}),(0,n.jsxs)("div",{className:"controls",children:[!q&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{children:"\uD83C\uDFAE 操作方法"}),!q&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"左右移動"}),(0,n.jsx)("span",{children:"← →"})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"回転"}),(0,n.jsx)("span",{children:"↑"})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"高速落下"}),(0,n.jsx)("span",{children:"↓"})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"配置決定"}),(0,n.jsx)("span",{children:"Enter"})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"一時停止"}),(0,n.jsx)("span",{children:"Space"})]})]}),(0,n.jsx)("button",{className:"upload-btn place-btn",onClick:V,children:"\uD83D\uDCCD 配置決定"}),(0,n.jsx)("button",{className:"reset-btn",onClick:X,children:"\uD83D\uDD04 リセット"})]}),(0,n.jsxs)("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255,255,255,0.1)",borderRadius:"10px"},children:[(0,n.jsx)("h4",{style:{marginTop:0,color:"var(--secondary)"},children:"\uD83D\uDCCA 統計"}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"配置済み"}),(0,n.jsx)("span",{children:D})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"残り"}),(0,n.jsx)("span",{children:E-D})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"進捗"}),(0,n.jsxs)("span",{children:[$,"%"]})]})]})]}),q&&(0,n.jsx)("div",{className:"mobile-controls",children:(0,n.jsxs)("div",{className:"controller",children:[(0,n.jsxs)("div",{className:"d-pad",children:[(0,n.jsx)(a.A,{className:"control-btn up",variant:"contained",color:"primary",onTouchStart:()=>Y("rotate"),children:(0,n.jsx)(h.A,{})}),(0,n.jsxs)("div",{className:"horizontal",children:[(0,n.jsx)(a.A,{className:"control-btn left",variant:"contained",color:"primary",onTouchStart:()=>Y("left"),children:(0,n.jsx)(c.A,{})}),(0,n.jsx)(a.A,{className:"control-btn down",variant:"contained",color:"primary",onTouchStart:()=>Y("down"),children:(0,n.jsx)(o.A,{})}),(0,n.jsx)(a.A,{className:"control-btn right",variant:"contained",color:"primary",onTouchStart:()=>Y("right"),children:(0,n.jsx)(i.A,{})})]})]}),(0,n.jsxs)("div",{className:"action-buttons",children:[(0,n.jsxs)(a.A,{className:"control-btn place",variant:"contained",color:"primary",onTouchStart:()=>Y("place"),children:[(0,n.jsx)(s.A,{component:"span",sx:{mr:.5},children:(0,n.jsx)(d.A,{})})," 配置"]}),(0,n.jsx)(a.A,{className:"control-btn pause",variant:"contained",color:"primary",onTouchStart:()=>Y(N?"restart":"pause"),children:N?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.A,{component:"span",sx:{mr:.5},children:(0,n.jsx)(m.A,{})}),"再開"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.A,{component:"span",sx:{mr:.5},children:(0,n.jsx)(u.A,{})}),"一時停止"]})})]})]})})]})]})}},9096:(e,t,r)=>{Promise.resolve().then(r.bind(r,3792))}},e=>{e.O(0,[987,441,964,358],()=>e(e.s=9096)),_N_E=e.O()}]);