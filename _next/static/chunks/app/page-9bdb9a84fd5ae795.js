(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3792:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>s});var r=l(5155),a=l(2115);let n=[{shape:[[1,1,1,1]],color:[0,255,255]},{shape:[[1,1],[1,1]],color:[255,255,0]},{shape:[[0,1,0],[1,1,1]],color:[128,0,128]},{shape:[[0,1,1],[1,1,0]],color:[0,255,0]},{shape:[[1,1,0],[0,1,1]],color:[255,0,0]},{shape:[[1,0,0],[1,1,1]],color:[0,0,255]},{shape:[[0,0,1],[1,1,1]],color:[255,165,0]}];function s(){let e=(0,a.useRef)(null),t=(0,a.useRef)(null),l=(0,a.useRef)(0),[s,i]=(0,a.useState)([]),[c,o]=(0,a.useState)([]),[h,d]=(0,a.useState)(null),[u,f]=(0,a.useState)(!1),[p,m]=(0,a.useState)(!1),[x,g]=(0,a.useState)(!1),[j,v]=(0,a.useState)(0),[w,y]=(0,a.useState)(0),[b,D]=(0,a.useState)(0),[k,S]=(0,a.useState)(0),[C,N]=(0,a.useState)(0),[E,R]=(0,a.useState)(20),M=(0,a.useCallback)(()=>{if(!k||!C)return 20;let e=window.innerWidth;return Math.max(8,Math.floor(Math.min(.8*e/k,.6*window.innerHeight/C,30)))},[k,C]);(0,a.useEffect)(()=>{let e,t=()=>{R(M())},l=()=>{clearTimeout(e),e=setTimeout(t,100)};return t(),window.addEventListener("resize",l),()=>{window.removeEventListener("resize",l),clearTimeout(e)}},[M]);let A=(0,a.useCallback)(e=>{let t=document.createElement("canvas"),l=t.getContext("2d");t.width=e.width,t.height=e.height,l.drawImage(e,0,0);let r=l.getImageData(0,0,e.width,e.height).data,a=Math.min(e.width,e.height),n=T(a),s=[],c=[];for(let t=0;t<n;t++){s[t]=[],c[t]=[];for(let l=0;l<n;l++){let i=Math.floor(l*a/n),o=(Math.floor(t*a/n)*e.width+i)*4,h=(r[o]+r[o+1]+r[o+2])/3;s[t][l]=+(h<128),c[t][l]=0}}F(s,c,n),i(s),o(c),S(n),N(n),y(L(s,c)),f(!0)},[]),T=e=>e<=25?21:e<=30?25:e<=35?29:Math.min(41,Math.max(21,2*Math.floor(e/8)+1)),F=(e,t,l)=>{for(let r=0;r<l;r++)for(let a=0;a<l;a++)(a<9&&r<9||a>=l-8&&r<9||a<9&&r>=l-8)&&(t[r][a]=e[r][a])},L=(e,t)=>{let l=0;for(let r=0;r<e.length;r++)for(let a=0;a<e[r].length;a++)1===e[r][a]&&0===t[r][a]&&l++;return l},O=(0,a.useCallback)(()=>{let e=n[Math.floor(Math.random()*n.length)];return{x:Math.floor((k-e.shape[0].length)/2),y:0,shape:JSON.parse(JSON.stringify(e.shape)),color:e.color,width:e.shape[0].length,height:e.shape.length}},[k]),_=(e,t,l)=>{for(let r=0;r<e.height;r++)for(let a=0;a<e.width;a++)if(1===e.shape[r][a]){let e=t+a,n=l+r;if(e<0||e>=k||n<0||n>=C||c[n]&&0!==c[n][e])return!1}return!0},Q=(0,a.useCallback)(()=>{if(!h)return;let e=!1,t=[...c];for(let l=0;l<h.height;l++)for(let r=0;r<h.width;r++)if(1===h.shape[l][r]){let a=h.x+r,n=h.y+l;a>=0&&a<k&&n>=0&&n<C&&1===s[n][a]&&0===c[n][a]&&(t[n][a]=1,v(e=>e+1),e=!0)}e&&o(t),d(O())},[h,c,s,k,C,O]),q=(0,a.useCallback)(()=>{f(!1),g(!1),d(null),i([]),o([]),v(0),y(0),D(0),S(0),N(0),m(!1),l.current&&cancelAnimationFrame(l.current),t.current&&(t.current.value="");let e=document.querySelector(".popup");e&&e.remove()},[]);(0,a.useEffect)(()=>{let e=e=>{if(h&&!p&&!x)switch(e.code){case"ArrowLeft":_(h,h.x-1,h.y)&&d(e=>e?{...e,x:e.x-1}:null);break;case"ArrowRight":_(h,h.x+1,h.y)&&d(e=>e?{...e,x:e.x+1}:null);break;case"ArrowDown":_(h,h.x,h.y+1)&&d(e=>e?{...e,y:e.y+1}:null);break;case"ArrowUp":let t=(e=>{let t=[],l=e.shape.length,r=e.shape[0].length;for(let a=0;a<r;a++){t[a]=[];for(let r=0;r<l;r++)t[a][r]=e.shape[l-1-r][a]}return{...e,shape:t,width:t[0].length,height:t.length}})(h);_(t,t.x,t.y)&&d(t);break;case"Enter":Q();break;case"Space":e.preventDefault(),m(e=>!e)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[h,p,x,Q]),(0,a.useEffect)(()=>{if(!u||x||!h)return;let e=()=>{p||D(e=>e>=60?(_(h,h.x,h.y+1)?d(e=>e?{...e,y:e.y+1}:null):Q(),0):e+1),l.current=requestAnimationFrame(e)};return l.current=requestAnimationFrame(e),()=>{l.current&&cancelAnimationFrame(l.current)}},[u,x,h,p,Q]),(0,a.useEffect)(()=>{if(!u||!e.current)return;let t=e.current,l=t.getContext("2d");t.width=k*E,t.height=C*E,(()=>{l.clearRect(0,0,t.width,t.height),l.fillStyle="#f0f0f0",l.fillRect(0,0,t.width,t.height);for(let e=0;e<C;e++)for(let t=0;t<k;t++){let r=t*E,a=e*E;1===c[e][t]?(l.fillStyle="#000000",l.fillRect(r,a,E,E),l.strokeStyle="#666666"):(1===s[e][t]?l.fillStyle="rgba(200, 200, 255, 0.4)":l.fillStyle="#ffffff",l.fillRect(r,a,E,E),l.strokeStyle="#cccccc"),l.strokeRect(r,a,E,E)}if(h){l.fillStyle="rgba(".concat(h.color[0],", ").concat(h.color[1],", ").concat(h.color[2],", 0.8)"),l.strokeStyle="#000000";for(let e=0;e<h.height;e++)for(let t=0;t<h.width;t++)if(1===h.shape[e][t]){let r=(h.x+t)*E,a=(h.y+e)*E;l.fillRect(r,a,E,E),l.strokeRect(r,a,E,E)}}})()},[u,c,h,s,k,C]),(0,a.useEffect)(()=>{u&&!h&&k>0&&d(O())},[u,h,k,O]),(0,a.useEffect)(()=>{if(x||!u)return;let e=!0;for(let t=0;t<C;t++){for(let l=0;l<k;l++)if(1===s[t][l]&&1!==c[t][l]){e=!1;break}if(!e)break}if(e){g(!0);let e=document.createElement("div");e.className="popup",e.innerHTML="\uD83C\uDF89 COMPLETE! \uD83C\uDF89<br><br>QRコード完成おめでとう！",document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}},[c,s,x,u,C,k]);let z=e=>{let t=new FileReader;t.onload=e=>{var t;let l=new Image;l.onload=()=>A(l),l.src=null==(t=e.target)?void 0:t.result},t.readAsDataURL(e)},I=w>0?Math.round(j/w*100):0;return(0,r.jsxs)("div",{className:"container",children:[(0,r.jsx)("h1",{className:"title",children:"\uD83C\uDFAE QRコードテトリスゲーム"}),(0,r.jsx)("p",{className:"subtitle",children:"QRコードをアップロードして、ブロックを積み重ねて元の画像を完成させよう！"}),!u&&(0,r.jsxs)("div",{className:"upload-area",onDrop:e=>{e.preventDefault();let t=e.dataTransfer.files[0];t&&z(t)},onDragOver:e=>e.preventDefault(),onClick:()=>{var e;return null==(e=t.current)?void 0:e.click()},children:[(0,r.jsx)("p",{style:{fontSize:"1.3rem",marginBottom:"20px"},children:"\uD83D\uDCF1 QRコードの画像をここにドラッグ＆ドロップ"}),(0,r.jsx)("p",{style:{marginBottom:"20px"},children:"または"}),(0,r.jsx)("button",{className:"upload-btn",children:"\uD83D\uDCC1 ファイルを選択"}),(0,r.jsx)("input",{ref:t,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{var t;let l=null==(t=e.target.files)?void 0:t[0];l&&z(l)}})]}),u&&(0,r.jsxs)("div",{className:"game-container",children:[(0,r.jsx)("div",{className:"game-area",children:(0,r.jsx)("canvas",{ref:e})}),(0,r.jsxs)("div",{className:"controls",children:[(0,r.jsx)("h3",{children:"\uD83C\uDFAE 操作方法"}),(0,r.jsxs)("div",{className:"control-item",children:[(0,r.jsx)("span",{children:"左右移動"}),(0,r.jsx)("span",{children:"← →"})]}),(0,r.jsxs)("div",{className:"control-item",children:[(0,r.jsx)("span",{children:"回転"}),(0,r.jsx)("span",{children:"↑"})]}),(0,r.jsxs)("div",{className:"control-item",children:[(0,r.jsx)("span",{children:"高速落下"}),(0,r.jsx)("span",{children:"↓"})]}),(0,r.jsxs)("div",{className:"control-item",children:[(0,r.jsx)("span",{children:"配置決定"}),(0,r.jsx)("span",{children:"Enter"})]}),(0,r.jsxs)("div",{className:"control-item",children:[(0,r.jsx)("span",{children:"一時停止"}),(0,r.jsx)("span",{children:"Space"})]}),(0,r.jsx)("button",{className:"upload-btn place-btn",onClick:Q,children:"\uD83D\uDCCD 配置決定"}),(0,r.jsx)("button",{className:"reset-btn",onClick:q,children:"\uD83D\uDD04 リセット"}),(0,r.jsxs)("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255,255,255,0.1)",borderRadius:"10px"},children:[(0,r.jsx)("h4",{style:{marginTop:0,color:"var(--secondary)"},children:"\uD83D\uDCCA 統計"}),(0,r.jsxs)("div",{className:"control-item",children:[(0,r.jsx)("span",{children:"配置済み"}),(0,r.jsx)("span",{children:j})]}),(0,r.jsxs)("div",{className:"control-item",children:[(0,r.jsx)("span",{children:"残り"}),(0,r.jsx)("span",{children:w-j})]}),(0,r.jsxs)("div",{className:"control-item",children:[(0,r.jsx)("span",{children:"進捗"}),(0,r.jsxs)("span",{children:[I,"%"]})]})]})]})]})]})}},9096:(e,t,l)=>{Promise.resolve().then(l.bind(l,3792))}},e=>{e.O(0,[441,964,358],()=>e(e.s=9096)),_N_E=e.O()}]);