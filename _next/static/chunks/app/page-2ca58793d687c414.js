(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3792:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var n=r(5155),l=r(2115),a=r(109),s=r(2185),c=r(604),i=r(7082),o=r(4651),h=r(6949),d=r(3585),u=r(4345),x=r(2644),m=r(2173),f=r(8323),p=r(3337);let j=[{shape:[[1,1,1,1]],color:[0,255,255]},{shape:[[1,1],[1,1]],color:[255,255,0]},{shape:[[0,1,0],[1,1,1]],color:[128,0,128]},{shape:[[0,1,1],[1,1,0]],color:[0,255,0]},{shape:[[1,1,0],[0,1,1]],color:[255,0,0]},{shape:[[1,0,0],[1,1,1]],color:[0,0,255]},{shape:[[0,0,1],[1,1,1]],color:[255,165,0]}];function v(){let e=(0,l.useRef)(null),t=(0,l.useRef)(null),r=(0,l.useRef)(0),[v,g]=(0,l.useState)([]),[w,b]=(0,l.useState)([]),[y,N]=(0,l.useState)(null),[k,S]=(0,l.useState)(!1),[A,E]=(0,l.useState)(!1),[R,C]=(0,l.useState)(!1),[M,T]=(0,l.useState)(0),[L,F]=(0,l.useState)(0),[D,z]=(0,l.useState)(0),[O,_]=(0,l.useState)(0),[Q,q]=(0,l.useState)(0),[I,B]=(0,l.useState)(20),[H,J]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=()=>{J(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let P=(0,l.useCallback)(()=>{if(!O||!Q)return 20;let e=window.innerWidth;return Math.max(8,Math.floor(Math.min(.8*e/O,.6*window.innerHeight/Q,30)))},[O,Q]);(0,l.useEffect)(()=>{let e,t=()=>{B(P())},r=()=>{clearTimeout(e),e=setTimeout(t,100)};return t(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),clearTimeout(e)}},[P]);let U=(0,l.useCallback)(e=>{let t=document.createElement("canvas"),r=t.getContext("2d");t.width=e.width,t.height=e.height,r.drawImage(e,0,0);let n=r.getImageData(0,0,e.width,e.height).data,l=Math.min(e.width,e.height),a=W(l),s=[],c=[];for(let t=0;t<a;t++){s[t]=[],c[t]=[];for(let r=0;r<a;r++){let i=Math.floor(r*l/a),o=(Math.floor(t*l/a)*e.width+i)*4,h=(n[o]+n[o+1]+n[o+2])/3;s[t][r]=+(h<128),c[t][r]=0}}G(s,c,a),g(s),b(c),_(a),q(a),F(K(s,c)),S(!0)},[]),W=e=>e<=25?21:e<=30?25:e<=35?29:Math.min(41,Math.max(21,2*Math.floor(e/8)+1)),G=(e,t,r)=>{for(let n=0;n<r;n++)for(let l=0;l<r;l++)(l<9&&n<9||l>=r-8&&n<9||l<9&&n>=r-8)&&(t[n][l]=e[n][l])},K=(e,t)=>{let r=0;for(let n=0;n<e.length;n++)for(let l=0;l<e[n].length;l++)1===e[n][l]&&0===t[n][l]&&r++;return r},V=(0,l.useCallback)(()=>{let e=j[Math.floor(Math.random()*j.length)];return{x:Math.floor((O-e.shape[0].length)/2),y:0,shape:JSON.parse(JSON.stringify(e.shape)),color:e.color,width:e.shape[0].length,height:e.shape.length}},[O]),X=e=>{let t=[],r=e.shape.length,n=e.shape[0].length;for(let l=0;l<n;l++){t[l]=[];for(let n=0;n<r;n++)t[l][n]=e.shape[r-1-n][l]}return{...e,shape:t,width:t[0].length,height:t.length}},Y=(e,t,r)=>{for(let n=0;n<e.height;n++)for(let l=0;l<e.width;l++)if(1===e.shape[n][l]){let e=t+l,a=r+n;if(e<0||e>=O||a<0||a>=Q||w[a]&&0!==w[a][e])return!1}return!0},Z=(0,l.useCallback)(()=>{if(!y)return;let e=!1,t=[...w];for(let r=0;r<y.height;r++)for(let n=0;n<y.width;n++)if(1===y.shape[r][n]){let l=y.x+n,a=y.y+r;l>=0&&l<O&&a>=0&&a<Q&&1===v[a][l]&&0===w[a][l]&&(t[a][l]=1,T(e=>e+1),e=!0)}e&&b(t),N(V())},[y,w,v,O,Q,V]),$=(0,l.useCallback)(()=>{S(!1),C(!1),N(null),g([]),b([]),T(0),F(0),z(0),_(0),q(0),E(!1),r.current&&cancelAnimationFrame(r.current),t.current&&(t.current.value="");let e=document.querySelector(".popup");e&&e.remove()},[]),ee=e=>{if(y&&!R)switch(e){case"left":Y(y,y.x-1,y.y)&&N(e=>e?{...e,x:e.x-1}:null);break;case"right":Y(y,y.x+1,y.y)&&N(e=>e?{...e,x:e.x+1}:null);break;case"down":Y(y,y.x,y.y+1)&&N(e=>e?{...e,y:e.y+1}:null);break;case"rotate":let t=X(y);Y(t,t.x,t.y)&&N(t);break;case"place":Z();break;case"pause":E(!0);break;case"restart":E(!1)}};(0,l.useEffect)(()=>{let e=e=>{if(y&&!R)switch(e.code){case"ArrowLeft":Y(y,y.x-1,y.y)&&N(e=>e?{...e,x:e.x-1}:null);break;case"ArrowRight":Y(y,y.x+1,y.y)&&N(e=>e?{...e,x:e.x+1}:null);break;case"ArrowDown":Y(y,y.x,y.y+1)&&N(e=>e?{...e,y:e.y+1}:null);break;case"ArrowUp":let t=X(y);Y(t,t.x,t.y)&&N(t);break;case"Enter":Z();break;case"Space":e.preventDefault(),E(!A)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[y,A,R,Z]),(0,l.useEffect)(()=>{if(!k||R||!y||A){r.current&&cancelAnimationFrame(r.current);return}let e=()=>{z(e=>{if(e>=60)if(Y(y,y.x,y.y+1))return N(e=>e?{...e,y:e.y+1}:null),0;else return Z(),0;return e+1}),r.current=requestAnimationFrame(e)};return r.current=requestAnimationFrame(e),()=>{r.current&&cancelAnimationFrame(r.current)}},[k,R,y,A,Z,60]),(0,l.useEffect)(()=>{if(!k||!e.current)return;let t=e.current,r=t.getContext("2d");t.width=O*I,t.height=Q*I,(()=>{r.clearRect(0,0,t.width,t.height),r.fillStyle="#f0f0f0",r.fillRect(0,0,t.width,t.height);for(let e=0;e<Q;e++)for(let t=0;t<O;t++){let n=t*I,l=e*I;1===w[e][t]?(r.fillStyle="#000000",r.fillRect(n,l,I,I),r.strokeStyle="#666666"):(1===v[e][t]?r.fillStyle="rgba(200, 200, 255, 0.4)":r.fillStyle="#ffffff",r.fillRect(n,l,I,I),r.strokeStyle="#cccccc"),r.strokeRect(n,l,I,I)}if(y){r.fillStyle="rgba(".concat(y.color[0],", ").concat(y.color[1],", ").concat(y.color[2],", 0.8)"),r.strokeStyle="#000000";for(let e=0;e<y.height;e++)for(let t=0;t<y.width;t++)if(1===y.shape[e][t]){let n=(y.x+t)*I,l=(y.y+e)*I;r.fillRect(n,l,I,I),r.strokeRect(n,l,I,I)}}})()},[k,w,y,v,O,Q]),(0,l.useEffect)(()=>{k&&!y&&O>0&&N(V())},[k,y,O,V]),(0,l.useEffect)(()=>{if(R||!k)return;let e=!0;for(let t=0;t<Q;t++){for(let r=0;r<O;r++)if(1===v[t][r]&&1!==w[t][r]){e=!1;break}if(!e)break}if(e){C(!0);let e=document.createElement("div");e.className="popup",e.innerHTML="\uD83C\uDF89 COMPLETE! \uD83C\uDF89<br><br>QRコード完成おめでとう！",document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}},[w,v,R,k,Q,O]);let et=e=>{let t=new FileReader;t.onload=e=>{var t;let r=new Image;r.onload=()=>U(r),r.src=null==(t=e.target)?void 0:t.result},t.readAsDataURL(e)},er=L>0?Math.round(M/L*100):0;return(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)("h1",{className:"title",children:"QRコードテトリス"}),(0,n.jsxs)("p",{className:"subtitle",children:["QRコードをアップロードして、",(0,n.jsx)("br",{}),"ブロックを積み重ねて元の画像を完成させよう！"]}),!k&&(0,n.jsxs)("div",{className:"upload-area",onDrop:e=>{e.preventDefault();let t=e.dataTransfer.files[0];t&&et(t)},onDragOver:e=>e.preventDefault(),onClick:()=>{var e;return null==(e=t.current)?void 0:e.click()},children:[(0,n.jsxs)("p",{style:{fontSize:"1.3rem",marginBottom:"20px"},children:[(0,n.jsx)(c.A,{})," QRコードの画像をここにドラッグ＆ドロップ"]}),(0,n.jsx)("p",{style:{marginBottom:"20px"},children:"または"}),(0,n.jsxs)("button",{className:"upload-btn",children:[(0,n.jsx)(p.A,{})," ファイルを選択"]}),(0,n.jsx)("input",{ref:t,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&et(r)}})]}),k&&(0,n.jsxs)("div",{className:"game-container",children:[(0,n.jsx)("div",{className:"game-area",children:(0,n.jsx)("canvas",{ref:e})}),(0,n.jsxs)("div",{className:"controls",children:[!H&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{children:"操作方法"}),!H&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"左右移動"}),(0,n.jsx)("span",{children:"← →"})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"回転"}),(0,n.jsx)("span",{children:"↑"})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"高速落下"}),(0,n.jsx)("span",{children:"↓"})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"配置決定"}),(0,n.jsx)("span",{children:"Enter"})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"一時停止"}),(0,n.jsx)("span",{children:"Space"})]})]}),(0,n.jsx)("button",{className:"upload-btn place-btn",onClick:Z,children:"配置決定"}),(0,n.jsx)("button",{className:"reset-btn",onClick:$,children:"リセット"})]}),(0,n.jsxs)("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255,255,255,0.1)",borderRadius:"10px"},children:[(0,n.jsxs)("h4",{style:{marginTop:0,color:"var(--secondary)"},children:[(0,n.jsx)(f.A,{})," 統計"]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"配置済み"}),(0,n.jsx)("span",{children:M})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"残り"}),(0,n.jsx)("span",{children:L-M})]}),(0,n.jsxs)("div",{className:"control-item",children:[(0,n.jsx)("span",{children:"進捗"}),(0,n.jsxs)("span",{children:[er,"%"]})]})]})]}),H&&(0,n.jsx)("div",{className:"mobile-controls",children:(0,n.jsxs)("div",{className:"controller",children:[(0,n.jsxs)("div",{className:"d-pad",children:[(0,n.jsx)(a.A,{className:"control-btn up",variant:"contained",color:"primary",onTouchStart:()=>ee("rotate"),children:(0,n.jsx)(d.A,{})}),(0,n.jsxs)("div",{className:"horizontal",children:[(0,n.jsx)(a.A,{className:"control-btn left",variant:"contained",color:"primary",onTouchStart:()=>ee("left"),children:(0,n.jsx)(i.A,{})}),(0,n.jsx)(a.A,{className:"control-btn down",variant:"contained",color:"primary",onTouchStart:()=>ee("down"),children:(0,n.jsx)(h.A,{})}),(0,n.jsx)(a.A,{className:"control-btn right",variant:"contained",color:"primary",onTouchStart:()=>ee("right"),children:(0,n.jsx)(o.A,{})})]})]}),(0,n.jsxs)("div",{className:"action-buttons",children:[(0,n.jsxs)(a.A,{className:"control-btn place",variant:"contained",color:"primary",onTouchStart:()=>ee("place"),children:[(0,n.jsx)(s.A,{component:"span",sx:{mr:.5},children:(0,n.jsx)(u.A,{})})," 配置"]}),(0,n.jsx)(a.A,{className:"control-btn pause",variant:"contained",color:"primary",onTouchStart:()=>ee(A?"restart":"pause"),children:A?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.A,{component:"span",sx:{mr:.5},children:(0,n.jsx)(m.A,{})}),"再開"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.A,{component:"span",sx:{mr:.5},children:(0,n.jsx)(x.A,{})}),"一時停止"]})})]})]})})]})]})}},9096:(e,t,r)=>{Promise.resolve().then(r.bind(r,3792))}},e=>{e.O(0,[950,441,964,358],()=>e(e.s=9096)),_N_E=e.O()}]);