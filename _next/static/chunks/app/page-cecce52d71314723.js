(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3792:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var l=r(5155),n=r(2115);let a=[{shape:[[1,1,1,1]],color:[0,255,255]},{shape:[[1,1],[1,1]],color:[255,255,0]},{shape:[[0,1,0],[1,1,1]],color:[128,0,128]},{shape:[[0,1,1],[1,1,0]],color:[0,255,0]},{shape:[[1,1,0],[0,1,1]],color:[255,0,0]},{shape:[[1,0,0],[1,1,1]],color:[0,0,255]},{shape:[[0,0,1],[1,1,1]],color:[255,165,0]}];function s(){let e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=(0,n.useRef)(0),[s,c]=(0,n.useState)([]),[i,o]=(0,n.useState)([]),[h,u]=(0,n.useState)(null),[d,f]=(0,n.useState)(!1),[m,x]=(0,n.useState)(!1),[p,g]=(0,n.useState)(!1),[j,b]=(0,n.useState)(0),[w,v]=(0,n.useState)(0),[y,D]=(0,n.useState)(0),[N,k]=(0,n.useState)(0),[S,C]=(0,n.useState)(0),[E,R]=(0,n.useState)(20),[M,T]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=()=>{T(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let A=(0,n.useCallback)(()=>{if(!N||!S)return 20;let e=window.innerWidth;return Math.max(8,Math.floor(Math.min(.8*e/N,.6*window.innerHeight/S,30)))},[N,S]);(0,n.useEffect)(()=>{let e,t=()=>{R(A())},r=()=>{clearTimeout(e),e=setTimeout(t,100)};return t(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),clearTimeout(e)}},[A]);let F=(0,n.useCallback)(e=>{let t=document.createElement("canvas"),r=t.getContext("2d");t.width=e.width,t.height=e.height,r.drawImage(e,0,0);let l=r.getImageData(0,0,e.width,e.height).data,n=Math.min(e.width,e.height),a=L(n),s=[],i=[];for(let t=0;t<a;t++){s[t]=[],i[t]=[];for(let r=0;r<a;r++){let c=Math.floor(r*n/a),o=(Math.floor(t*n/a)*e.width+c)*4,h=(l[o]+l[o+1]+l[o+2])/3;s[t][r]=+(h<128),i[t][r]=0}}z(s,i,a),c(s),o(i),k(a),C(a),v(O(s,i)),f(!0)},[]),L=e=>e<=25?21:e<=30?25:e<=35?29:Math.min(41,Math.max(21,2*Math.floor(e/8)+1)),z=(e,t,r)=>{for(let l=0;l<r;l++)for(let n=0;n<r;n++)(n<9&&l<9||n>=r-8&&l<9||n<9&&l>=r-8)&&(t[l][n]=e[l][n])},O=(e,t)=>{let r=0;for(let l=0;l<e.length;l++)for(let n=0;n<e[l].length;n++)1===e[l][n]&&0===t[l][n]&&r++;return r},_=(0,n.useCallback)(()=>{let e=a[Math.floor(Math.random()*a.length)];return{x:Math.floor((N-e.shape[0].length)/2),y:0,shape:JSON.parse(JSON.stringify(e.shape)),color:e.color,width:e.shape[0].length,height:e.shape.length}},[N]),P=e=>{let t=[],r=e.shape.length,l=e.shape[0].length;for(let n=0;n<l;n++){t[n]=[];for(let l=0;l<r;l++)t[n][l]=e.shape[r-1-l][n]}return{...e,shape:t,width:t[0].length,height:t.length}},Q=(e,t,r)=>{for(let l=0;l<e.height;l++)for(let n=0;n<e.width;n++)if(1===e.shape[l][n]){let e=t+n,a=r+l;if(e<0||e>=N||a<0||a>=S||i[a]&&0!==i[a][e])return!1}return!0},q=(0,n.useCallback)(()=>{if(!h)return;let e=!1,t=[...i];for(let r=0;r<h.height;r++)for(let l=0;l<h.width;l++)if(1===h.shape[r][l]){let n=h.x+l,a=h.y+r;n>=0&&n<N&&a>=0&&a<S&&1===s[a][n]&&0===i[a][n]&&(t[a][n]=1,b(e=>e+1),e=!0)}e&&o(t),u(_())},[h,i,s,N,S,_]),I=(0,n.useCallback)(()=>{f(!1),g(!1),u(null),c([]),o([]),b(0),v(0),D(0),k(0),C(0),x(!1),r.current&&cancelAnimationFrame(r.current),t.current&&(t.current.value="");let e=document.querySelector(".popup");e&&e.remove()},[]),B=e=>{if(h&&!p)switch(e){case"left":Q(h,h.x-1,h.y)&&u(e=>e?{...e,x:e.x-1}:null);break;case"right":Q(h,h.x+1,h.y)&&u(e=>e?{...e,x:e.x+1}:null);break;case"down":Q(h,h.x,h.y+1)&&u(e=>e?{...e,y:e.y+1}:null);break;case"rotate":let t=P(h);Q(t,t.x,t.y)&&u(t);break;case"place":q();break;case"pause":x(!0);break;case"restart":x(!1)}};(0,n.useEffect)(()=>{let e=e=>{if(h&&!m&&!p)switch(e.code){case"ArrowLeft":Q(h,h.x-1,h.y)&&u(e=>e?{...e,x:e.x-1}:null);break;case"ArrowRight":Q(h,h.x+1,h.y)&&u(e=>e?{...e,x:e.x+1}:null);break;case"ArrowDown":Q(h,h.x,h.y+1)&&u(e=>e?{...e,y:e.y+1}:null);break;case"ArrowUp":let t=P(h);Q(t,t.x,t.y)&&u(t);break;case"Enter":q();break;case"Space":e.preventDefault(),x(e=>!e)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[h,m,p,q]),(0,n.useEffect)(()=>{if(console.log("ゲームループ isPaused--- ",m),!d||p||!h||m){r.current&&cancelAnimationFrame(r.current);return}let e=()=>{console.log("isPaused--- ",m),D(e=>{if(e>=60)if(Q(h,h.x,h.y+1))return u(e=>e?{...e,y:e.y+1}:null),0;else return q(),0;return e+1}),r.current=requestAnimationFrame(e)};return r.current=requestAnimationFrame(e),()=>{r.current&&cancelAnimationFrame(r.current)}},[d,p,h,m,q,60]),(0,n.useEffect)(()=>{if(!d||!e.current)return;let t=e.current,r=t.getContext("2d");t.width=N*E,t.height=S*E,(()=>{r.clearRect(0,0,t.width,t.height),r.fillStyle="#f0f0f0",r.fillRect(0,0,t.width,t.height);for(let e=0;e<S;e++)for(let t=0;t<N;t++){let l=t*E,n=e*E;1===i[e][t]?(r.fillStyle="#000000",r.fillRect(l,n,E,E),r.strokeStyle="#666666"):(1===s[e][t]?r.fillStyle="rgba(200, 200, 255, 0.4)":r.fillStyle="#ffffff",r.fillRect(l,n,E,E),r.strokeStyle="#cccccc"),r.strokeRect(l,n,E,E)}if(h){r.fillStyle="rgba(".concat(h.color[0],", ").concat(h.color[1],", ").concat(h.color[2],", 0.8)"),r.strokeStyle="#000000";for(let e=0;e<h.height;e++)for(let t=0;t<h.width;t++)if(1===h.shape[e][t]){let l=(h.x+t)*E,n=(h.y+e)*E;r.fillRect(l,n,E,E),r.strokeRect(l,n,E,E)}}})()},[d,i,h,s,N,S]),(0,n.useEffect)(()=>{d&&!h&&N>0&&u(_())},[d,h,N,_]),(0,n.useEffect)(()=>{if(p||!d)return;let e=!0;for(let t=0;t<S;t++){for(let r=0;r<N;r++)if(1===s[t][r]&&1!==i[t][r]){e=!1;break}if(!e)break}if(e){g(!0);let e=document.createElement("div");e.className="popup",e.innerHTML="\uD83C\uDF89 COMPLETE! \uD83C\uDF89<br><br>QRコード完成おめでとう！",document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}},[i,s,p,d,S,N]);let H=e=>{let t=new FileReader;t.onload=e=>{var t;let r=new Image;r.onload=()=>F(r),r.src=null==(t=e.target)?void 0:t.result},t.readAsDataURL(e)},J=w>0?Math.round(j/w*100):0;return(0,l.jsxs)("div",{className:"container",children:[(0,l.jsx)("h1",{className:"title",children:"\uD83C\uDFAE QRコードテトリスゲーム"}),(0,l.jsx)("p",{className:"subtitle",children:"QRコードをアップロードして、ブロックを積み重ねて元の画像を完成させよう！"}),!d&&(0,l.jsxs)("div",{className:"upload-area",onDrop:e=>{e.preventDefault();let t=e.dataTransfer.files[0];t&&H(t)},onDragOver:e=>e.preventDefault(),onClick:()=>{var e;return null==(e=t.current)?void 0:e.click()},children:[(0,l.jsx)("p",{style:{fontSize:"1.3rem",marginBottom:"20px"},children:"\uD83D\uDCF1 QRコードの画像をここにドラッグ＆ドロップ"}),(0,l.jsx)("p",{style:{marginBottom:"20px"},children:"または"}),(0,l.jsx)("button",{className:"upload-btn",children:"\uD83D\uDCC1 ファイルを選択"}),(0,l.jsx)("input",{ref:t,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&H(r)}})]}),d&&(0,l.jsxs)("div",{className:"game-container",children:[(0,l.jsx)("div",{className:"game-area",children:(0,l.jsx)("canvas",{ref:e})}),(0,l.jsxs)("div",{className:"controls",children:[(0,l.jsx)("h3",{children:"\uD83C\uDFAE 操作方法"}),!M&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"control-item",children:[(0,l.jsx)("span",{children:"左右移動"}),(0,l.jsx)("span",{children:"← →"})]}),(0,l.jsxs)("div",{className:"control-item",children:[(0,l.jsx)("span",{children:"回転"}),(0,l.jsx)("span",{children:"↑"})]}),(0,l.jsxs)("div",{className:"control-item",children:[(0,l.jsx)("span",{children:"高速落下"}),(0,l.jsx)("span",{children:"↓"})]}),(0,l.jsxs)("div",{className:"control-item",children:[(0,l.jsx)("span",{children:"配置決定"}),(0,l.jsx)("span",{children:"Enter"})]}),(0,l.jsxs)("div",{className:"control-item",children:[(0,l.jsx)("span",{children:"一時停止"}),(0,l.jsx)("span",{children:"Space"})]})]}),(0,l.jsx)("button",{className:"upload-btn place-btn",onClick:q,children:"\uD83D\uDCCD 配置決定"}),(0,l.jsx)("button",{className:"reset-btn",onClick:I,children:"\uD83D\uDD04 リセット"}),(0,l.jsxs)("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255,255,255,0.1)",borderRadius:"10px"},children:[(0,l.jsx)("h4",{style:{marginTop:0,color:"var(--secondary)"},children:"\uD83D\uDCCA 統計"}),(0,l.jsxs)("div",{className:"control-item",children:[(0,l.jsx)("span",{children:"配置済み"}),(0,l.jsx)("span",{children:j})]}),(0,l.jsxs)("div",{className:"control-item",children:[(0,l.jsx)("span",{children:"残り"}),(0,l.jsx)("span",{children:w-j})]}),(0,l.jsxs)("div",{className:"control-item",children:[(0,l.jsx)("span",{children:"進捗"}),(0,l.jsxs)("span",{children:[J,"%"]})]})]})]}),M&&(0,l.jsx)("div",{className:"mobile-controls",children:(0,l.jsxs)("div",{className:"controller",children:[(0,l.jsxs)("div",{className:"d-pad",children:[(0,l.jsx)("button",{className:"control-btn up",onTouchStart:()=>B("rotate"),children:"\uD83D\uDD04"}),(0,l.jsxs)("div",{className:"horizontal",children:[(0,l.jsx)("button",{className:"control-btn left",onTouchStart:()=>B("left"),children:"⬅️"}),(0,l.jsx)("button",{className:"control-btn down",onTouchStart:()=>B("down"),children:"⬇️"}),(0,l.jsx)("button",{className:"control-btn right",onTouchStart:()=>B("right"),children:"➡️"})]})]}),(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"control-btn place",onTouchStart:()=>B("place"),children:"\uD83D\uDCCD 配置"}),(0,l.jsx)("button",{className:"control-btn pause",onTouchStart:()=>m?B("restart"):B("pause"),children:m?"▶️ 再開":"⏸️ 一時停止"})]})]})})]})]})}},9096:(e,t,r)=>{Promise.resolve().then(r.bind(r,3792))}},e=>{e.O(0,[441,964,358],()=>e(e.s=9096)),_N_E=e.O()}]);